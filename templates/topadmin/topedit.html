{% extends './base.html' %}
{% block title %}{{top.name}}{% endblock %}
{% block content %}
{% if top.name %}
	<div class="row">
		<div class="col-12">
			<div class="box">
				<div class="box-item ">
					<div class="top-head d-flex align-items-center">
						<a class="top-url-eye btn-circle" href="{% url 'topshow' slug=top.slug %}?{{params}}" target="_blanc">
							<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 612 612" style="enable-background:new 0 0 612 612;" xml:space="preserve">
									<g>
										<path d="M609.608,315.426c3.19-5.874,3.19-12.979,0-18.853c-58.464-107.643-172.5-180.72-303.607-180.72
										S60.857,188.931,2.393,296.573c-3.19,5.874-3.19,12.979,0,18.853C60.858,423.069,174.892,496.147,306,496.147
										S551.143,423.069,609.608,315.426z M306,451.855c-80.554,0-145.855-65.302-145.855-145.855S225.446,160.144,306,160.144
										S451.856,225.446,451.856,306S386.554,451.855,306,451.855z" />
										<path d="M306,231.67c-6.136,0-12.095,0.749-17.798,2.15c5.841,6.76,9.383,15.563,9.383,25.198c0,21.3-17.267,38.568-38.568,38.568
										c-9.635,0-18.438-3.541-25.198-9.383c-1.401,5.703-2.15,11.662-2.15,17.798c0,41.052,33.279,74.33,74.33,74.33
										s74.33-33.279,74.33-74.33S347.052,231.67,306,231.67z" />
									</g>
							</svg>
						</a>
							<h3>{{top.name}}</h3>
					</div>
					<div class="top-url">
						<p class="top-info d-flex">
							<a href="{% url 'topshow' slug=top.slug %}?{{params}}"></a>
							<button class="top-url-copy top-url-copy-edit btn-circle">
								<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
								 viewBox="0 0 488.3 488.3" style="enable-background:new 0 0 488.3 488.3;" xml:space="preserve">
								 <g>
								 	<path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124
								 		C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124
								 		c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/>
								 	<path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227
								 		c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6
								 		V38.6C439.65,17.3,422.35,0,401.05,0z"/>
								 </g>
								</svg>
							</button>
							<textarea class="top-url-input" readonly></textarea>
							
						</p>
					</div>
					<div class="top-mail">
						<a class="top-url-copy top-url-copy-edit btn-circle" href="#top-mails-list" data-bs-target="#top-mails-list" data-bs-toggle="modal">
							<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
								 viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
								 <g>
								 	<path d="M477.576,229.429l0.043-0.043L345.664,96.226c-9.134-9.219-21.312-14.313-34.29-14.342c-0.039,0-0.076,0-0.115,0
								 		c-12.934,0-25.094,5.036-34.245,14.187l-16.12,16.122c-1.763,1.763-3.823,2.026-4.893,2.026s-3.13-0.263-4.892-2.026
								 		L234.987,96.07c-9.151-9.15-21.309-14.185-34.243-14.185c-0.039,0-0.078,0-0.115,0c-12.979,0.029-25.157,5.123-34.29,14.342
								 		L34.384,229.386l0.043,0.043C13.165,250.722,0,280.098,0,312.494c0,64.857,52.765,117.622,117.622,117.622
								 		c45.947,0,85.799-26.497,105.147-64.999c9.624,6.1,21.018,9.648,33.232,9.648c12.213,0,23.607-3.548,33.232-9.648
								 		c19.348,38.502,59.2,64.999,105.147,64.999C459.235,430.115,512,377.35,512,312.494C512,280.098,498.835,250.722,477.576,229.429z
								 		 M117.622,388.602c-41.966,0-76.108-34.142-76.108-76.108s34.142-76.108,76.108-76.108s76.108,34.142,76.108,76.108
								 		S159.588,388.602,117.622,388.602z M256,340.169c-15.285,0-27.676-12.39-27.676-27.676s12.39-27.676,27.676-27.676
								 		s27.676,12.39,27.676,27.676S271.285,340.169,256,340.169z M394.378,388.602c-41.966,0-76.108-34.142-76.108-76.108
								 		s34.142-76.108,76.108-76.108c41.966,0,76.108,34.142,76.108,76.108S436.344,388.602,394.378,388.602z"/>
								 </g>
							</svg>
						</a>
						<p>Почты - <span>{{top.mails.count}}</span></p>
					</div>
					<div class="modal fade" id="top-mails-list" style="display: none;" tabindex="-1" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content position-relative">
								<button type="button" class="close modal-close" data-bs-dismiss="modal" aria-label="Close">
									<span aria-hidden="true">×</span>
								</button>
								<div class="modal-wrapper">
									<h4>Почты</h4>
									<ul>
										{% for mail in top.mails.all %}
											<li>{{mail.mail}}</li>
										{% endfor %}
									</ul>
									
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="historia">
					<div class="row d-flex justify-content-end">
						<div class="col-4">
							<div class="d-flex">
								<h4 class="">Последние изменения:</h4>

							</div>
							
							<p>{{top.date_modified1|date:"j.m.y - G:i"}} — {{top.thing_modified1}}</p>
							<p>{{top.date_modified2|date:"j.m.y - G:i"}} — {{top.thing_modified2}}</p>
							<p>{{top.date_modified3|date:"j.m.y - G:i"}} — {{top.thing_modified3}}</p>
							<p>{{top.date_modified4|date:"j.m.y - G:i"}} — {{top.thing_modified4}}</p>
							<p>{{top.date_modified5|date:"j.m.y - G:i"}} — {{top.thing_modified5}}</p>
						</div>
					</div>
					
				</div>
				<!-- <p>last edit: {{top.date_modified|date:"H:i:s d.m.Y" }}</p> -->
			
				<div class="casinos d-flex justify-content-between">
					<div class="casinos-block casinos-block-top">
						<h2 class="subheader">Casinos in Top</h2>
						<div class="box-item">
							<ul id="sortable1" class="connectedSortable casinos-box casinos-box-top">
								{% for casino in casinos_top %}
									<li class="casino-top" id={{casino.id}} data-position={{casino.position}}>
										<div class="casino-top-namebox">
											<h4>
												{{casino.name}}
												<!-- <span class="casino-top-namebox-hide">
														{{casino.link}}
													</span> -->
											</h4>
											<a class="btn-circle" href="{% url 'casinoedit' slug=casino.id %}" target="_blanc">
												<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 490.305 490.305" style="enable-background:new 0 0 490.305 490.305;" xml:space="preserve">
														<g>
															<path d="M472.469,81.443l-63.6-63.6c-13.1-16.4-53.2-30.2-83.4,0l-290.9,289.9l0,0c-4.4,4.4-6.5,10.1-6.2,15.6l-27.1,141.8
															c-4.2,16.2,11.9,26.6,22.9,25l147-29.2c4.2,0,7.3-2.1,10.4-5.2l290.9-289.8C495.469,142.943,495.469,104.443,472.469,81.443z
															 M354.669,46.043c6.3-7.3,18.8-7.3,26.1,0l17.3,17l-289.7,289.7l-30.1-30.4L354.669,46.043z M61.769,364.043l64.4,64.4l-80.1,15.8
															L61.769,364.043z M444.369,135.643l-276.8,276.8l-30.1-30.4l290-290l16.8,16.5C453.469,118.343,449.169,130.743,444.369,135.643z"
															/>
														</g>
												</svg>
											</a>
										</div>
																			
										<div class="casino-top-ccs">
											{% for ccs in casino.country.all %}
												<span class="casino-top-ccs-visible">{{ccs.country.slug}}
													<!-- <span class="casino-top-ccs-hide">
														{{ccs.link}}
													</span> -->
												</span>
											{% endfor %}
										</div>
									</li>
								{% endfor %}
							</ul>
						</div>
					</div>
					<div class="casinos-block casinos-block-all">
						<h2 class="subheader">All Casinos</h2>
						<div class="box-item">
							<ul id="sortable2" class="connectedSortable casinos-box casinos-box-all">
								{% for casino in casinos_all %}
									<li class="casino-top" id={{casino.id}}>
										<div class="casino-top-namebox">
											<h4>
												{{casino.name}}
												<!-- <span class="casino-top-namebox-hide">
														{{casino.link}}
													</span> -->
											</h4>
											<a class="btn-circle" href="{% url 'casinoedit' slug=casino.id %}" target="_blanc">
												<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 490.305 490.305" style="enable-background:new 0 0 490.305 490.305;" xml:space="preserve">
														<g>
															<path d="M472.469,81.443l-63.6-63.6c-13.1-16.4-53.2-30.2-83.4,0l-290.9,289.9l0,0c-4.4,4.4-6.5,10.1-6.2,15.6l-27.1,141.8
															c-4.2,16.2,11.9,26.6,22.9,25l147-29.2c4.2,0,7.3-2.1,10.4-5.2l290.9-289.8C495.469,142.943,495.469,104.443,472.469,81.443z
															 M354.669,46.043c6.3-7.3,18.8-7.3,26.1,0l17.3,17l-289.7,289.7l-30.1-30.4L354.669,46.043z M61.769,364.043l64.4,64.4l-80.1,15.8
															L61.769,364.043z M444.369,135.643l-276.8,276.8l-30.1-30.4l290-290l16.8,16.5C453.469,118.343,449.169,130.743,444.369,135.643z"
															/>
														</g>
												</svg>
											</a>
										</div>
										<div class="casino-top-ccs">
											{% for ccs in casino.country.all %}
												<span class="casino-top-ccs-visible">{{ccs.country.slug}}
													<!-- <span class="casino-top-ccs-hide">
														{{ccs.link}}
													</span> -->
												</span>
											{% endfor %}
										</div>
									</li>
								{% endfor %}
							</ul>
						</div>
					</div>
				</div>
				<h3>Настройки Топа</h3>
		
{% else %}
	<h2 class="text-center">Новый ТОП</h2>
{% endif %}
	
				
				<div class="box-item">
					<form method="POST" enctype="multipart/form-data">
						{% csrf_token %}
{#						{{form.as_p}}#}
                        {% for field in form %}
                            {% if field.id_for_label == 'id_color' %}
                               <div style="width: 100%; margin-top: 50px">
                                    <h3 style="text-align: center; width: 100%">НАСТРОЙКА ЦВЕТА</h3>
                                    <hr style="width: 100%;">
                               </div>
                            {% endif %}
                            <p>
                                {{ field.label_tag }} {{ field }}
                                {% if field.help_text %}
                                    <span class="helptext">{{ field.help_text }}</span>
                                {% endif %}
                            </p>
                        {% endfor %}
						<div class="btn-box">
							<input class="btn" type="submit" value="save">
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
{% block scripts %}

		<script>
		$(function() {
			$("#sortable1, #sortable2").sortable({
				connectWith: ".connectedSortable",
				placeholder: 'emptySpace',
				cursor: "move",
			}).disableSelection();
			/*$("#sortable1").sortable({
				update: sender(event, ui),
			}).disableSelection();*/
		});
		let href = window.location.origin + "{%  url 'position' slug=top.slug%}";
		$("#sortable1").on("sortupdate", function(event, ui) {
			let arrayCasinoId = $("#sortable1").sortable("toArray");
			let deleteCasinoId
			if (arrayCasinoId.indexOf(ui.item.attr("id")) == -1) {
				deleteCasinoId = ui.item.attr("id")
			}
			$.ajax({
				url: href,
				method: "POST",
				dataType: "json",
				cache: false,
				success: function() {
					console.log('send ' + arrayCasinoId);
				},
				data: {
					array_casino_id: JSON.stringify(arrayCasinoId),
					delete_casino_id: deleteCasinoId
				}
			}).done((responce) => {
				console.log('send ' + responce);
			})
		});

		function sender(event, ui) {
			var casino_id = $("#sortable1").sortable("toArray");
			console.log(ui.sender);
			if (ui.sender == $("#sortable1")) {
				console.log("from top!")
			}
			$.ajax({
				url: href,
				method: "POST",
				dataType: "json",
				cache: false,
				success: function() {
					console.log('send ' + casino_id);
				},
				data: {
					casino_id: JSON.stringify(casino_id)
				}
			}).done((responce) => {
				console.log('send ' + responce);
			})
		};
		/* $("#sortable1").on("sortupdate", function(event, ui){
			var sortedIDs = $( "#sortable1" ).sortable( "toArray" );
			console.log('send ' + sortedIDs)
		  });
	*/
		</script>
{% endblock %}
	
</body>

</html>